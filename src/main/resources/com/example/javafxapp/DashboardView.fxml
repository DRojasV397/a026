<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.*?>
<?import javafx.scene.shape.*?>

<BorderPane xmlns="http://javafx.com/javafx/17.0.2"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.example.javafxapp.DashboardController"
            prefWidth="1280"
            prefHeight="720"
            stylesheets="@styles/dashboard.css"
            styleClass="dashboard-root">

    <!-- ============================================
         SIDEBAR - Left Panel
         ============================================ -->
    <left>
        <VBox fx:id="sidebar" spacing="12" prefWidth="200" styleClass="sidebar" BorderPane.alignment="CENTER_LEFT">
            <padding>
                <Insets top="16" right="12" bottom="16" left="12"/>
            </padding>

            <!-- App Logo and Name -->
            <HBox alignment="CENTER_LEFT" spacing="10">
                <StackPane styleClass="sidebar-logo" alignment="CENTER">
                    <SVGPath fill="#3B82F6" content="M2 14 L2 10 L8 4 L12 8 L20 0 L22 2 L12 12 L8 8 L4 12 L4 14 Z" scaleX="0.8" scaleY="0.8"/>
                </StackPane>
                <Label text="BI Analytics" styleClass="sidebar-title"/>
                <Pane HBox.hgrow="ALWAYS"/>
                <Button fx:id="collapseBtn" text="≡" onAction="#collapseSidebar" focusTraversable="false"
                        styleClass="sidebar-collapse" minWidth="24" prefWidth="24" maxWidth="24"/>
                <Button fx:id="expandBtn" text="≫" onAction="#expandSidebar" focusTraversable="false"
                        visible="false" managed="false" styleClass="sidebar-collapse" minWidth="24" prefWidth="24" maxWidth="24"/>
            </HBox>

            <Separator opacity="0.15"/>

            <!-- Navigation Menu -->
            <VBox spacing="6">
                <ToggleButton fx:id="menuDashboard" text="Dashboard" selected="true" onAction="#navDashboard"
                              styleClass="sidebar-item" maxWidth="Infinity" contentDisplay="LEFT">
                    <graphic>
                        <SVGPath content="M3 11 L12 3 L21 11 V21 H14 V14 H10 V21 H3 Z" styleClass="sidebar-icon" scaleX="0.7" scaleY="0.7"/>
                    </graphic>
                </ToggleButton>

                <ToggleButton fx:id="menuPredictive" text="Predictive Analysis" onAction="#navPredictive"
                              styleClass="sidebar-item" maxWidth="Infinity" contentDisplay="LEFT">
                    <graphic>
                        <SVGPath content="M3 17 L9 11 L13 15 L21 7" styleClass="sidebar-icon" scaleX="0.7" scaleY="0.7"/>
                    </graphic>
                </ToggleButton>

                <ToggleButton fx:id="menuProfitability" text="Profitability" onAction="#navProfitability"
                              styleClass="sidebar-item" maxWidth="Infinity" contentDisplay="LEFT">
                    <graphic>
                        <SVGPath content="M12 2 C6.48 2 2 6.48 2 12 C2 17.52 6.48 22 12 22 C17.52 22 22 17.52 22 12 C22 6.48 17.52 2 12 2 Z M13.41 18.09 L13.41 20 L10.59 20 L10.59 18.09 C9.07 17.93 7.5 17.16 7.5 15.5 L9.5 15.5 C9.5 16.5 10.5 17 11.5 17 C12.5 17 13.5 16.5 13.5 15.5 C13.5 14.5 12.5 14 11.5 14 C9.5 14 7.5 13 7.5 11 C7.5 9.34 9.07 8.57 10.59 8.41 L10.59 7 L13.41 7 L13.41 8.41 C14.93 8.57 16.5 9.34 16.5 11 L14.5 11 C14.5 10 13.5 9.5 12.5 9.5 C11.5 9.5 10.5 10 10.5 11 C10.5 12 11.5 12.5 12.5 12.5 C14.5 12.5 16.5 13.5 16.5 15.5 C16.5 17.16 14.93 17.93 13.41 18.09 Z" styleClass="sidebar-icon" scaleX="0.7" scaleY="0.7"/>
                    </graphic>
                </ToggleButton>

                <ToggleButton fx:id="menuSimulation" text="Simulation" onAction="#navSimulation"
                              styleClass="sidebar-item" maxWidth="Infinity" contentDisplay="LEFT">
                    <graphic>
                        <SVGPath content="M6 3 L6 11 L2 11 L2 21 L10 21 L10 17 L14 17 L14 21 L22 21 L22 7 L14 7 L14 3 Z M8 5 L12 5 L12 9 L16 9 L16 19 L16 19 L12 19 L12 15 L8 15 L8 13 L4 13 L4 19 L8 19 Z" styleClass="sidebar-icon" scaleX="0.7" scaleY="0.7"/>
                    </graphic>
                </ToggleButton>

                <ToggleButton fx:id="menuData" text="Data Management" onAction="#navData"
                              styleClass="sidebar-item" maxWidth="Infinity" contentDisplay="LEFT">
                    <graphic>
                        <SVGPath content="M12 3 C7.03 3 3 4.79 3 7 L3 17 C3 19.21 7.03 21 12 21 C16.97 21 21 19.21 21 17 L21 7 C21 4.79 16.97 3 12 3 Z M12 5 C15.87 5 19 6.34 19 7 C19 7.66 15.87 9 12 9 C8.13 9 5 7.66 5 7 C5 6.34 8.13 5 12 5 Z M19 12 C19 12.66 15.87 14 12 14 C8.13 14 5 12.66 5 12 L5 9.5 C6.92 10.67 9.62 11 12 11 C14.38 11 17.08 10.67 19 9.5 Z M19 17 C19 17.66 15.87 19 12 19 C8.13 19 5 17.66 5 17 L5 14.5 C6.92 15.67 9.62 16 12 16 C14.38 16 17.08 15.67 19 14.5 Z" styleClass="sidebar-icon" scaleX="0.7" scaleY="0.7"/>
                    </graphic>
                </ToggleButton>

                <ToggleButton fx:id="menuAlerts" text="Alerts" onAction="#navAlerts"
                              styleClass="sidebar-item" maxWidth="Infinity" contentDisplay="LEFT">
                    <graphic>
                        <SVGPath content="M12 22 C13.1 22 14 21.1 14 20 L10 20 C10 21.1 10.89 22 12 22 Z M18 16 L18 11 C18 7.93 16.36 5.36 13.5 4.68 L13.5 4 C13.5 3.17 12.83 2.5 12 2.5 C11.17 2.5 10.5 3.17 10.5 4 L10.5 4.68 C7.63 5.36 6 7.92 6 11 L6 16 L4 18 L4 19 L20 19 L20 18 Z" styleClass="sidebar-icon" scaleX="0.7" scaleY="0.7"/>
                    </graphic>
                </ToggleButton>

                <ToggleButton fx:id="menuReports" text="Reports" onAction="#navReports"
                              styleClass="sidebar-item" maxWidth="Infinity" contentDisplay="LEFT">
                    <graphic>
                        <SVGPath content="M6 2 C4.9 2 4 2.9 4 4 L4 20 C4 21.1 4.89 22 5.99 22 L18 22 C19.1 22 20 21.1 20 20 L20 8 L14 2 Z M13 3.5 L18.5 9 L13 9 Z M8 12 L16 12 L16 14 L8 14 Z M8 16 L16 16 L16 18 L8 18 Z" styleClass="sidebar-icon" scaleX="0.7" scaleY="0.7"/>
                    </graphic>
                </ToggleButton>
            </VBox>

            <Pane VBox.vgrow="ALWAYS"/>

            <!-- User Section at Bottom -->
            <VBox spacing="8">
                <Separator opacity="0.15"/>
                <HBox spacing="10" alignment="CENTER_LEFT">
                    <Circle radius="16" fill="#0EA5E9"/>
                    <VBox spacing="2">
                        <Label text="Juan Pérez" style="-fx-text-fill: #E2E8F0; -fx-font-weight: bold; -fx-font-size: 13px;"/>
                        <Label text="Administrador" style="-fx-text-fill: #94A3B8; -fx-font-size: 11px;"/>
                    </VBox>
                </HBox>
                <Button text="Cerrar Sesión" onAction="#handleLogout" styleClass="sidebar-logout" maxWidth="Infinity"/>
            </VBox>
        </VBox>
    </left>

    <!-- ============================================
         HEADER - Top Bar
         ============================================ -->
    <top>
        <HBox spacing="16" styleClass="header-bar" alignment="CENTER_LEFT">
            <padding>
                <Insets top="12" right="24" bottom="12" left="24"/>
            </padding>

            <!-- Title Section -->
            <VBox spacing="2">
                <Label fx:id="titleLabel" text="Dashboard" styleClass="header-title"/>
                <Label fx:id="subtitleLabel" text="Resumen general de tu negocio" styleClass="header-subtitle"/>
            </VBox>

            <Pane HBox.hgrow="ALWAYS"/>

            <!-- Period Selector -->
            <HBox spacing="8" alignment="CENTER">
                <ToggleButton fx:id="periodWeek" text="Semana" onAction="#onPeriodChange" styleClass="button-outlined"/>
                <ToggleButton fx:id="periodMonth" text="Mes" selected="true" onAction="#onPeriodChange" styleClass="button-primary"/>
                <ToggleButton fx:id="periodYear" text="Año" onAction="#onPeriodChange" styleClass="button-outlined"/>
            </HBox>

            <!-- User Avatar -->
            <HBox spacing="10" alignment="CENTER">
                <Label text="Juan Pérez" style="-fx-text-fill: #1E293B; -fx-font-size: 14px; -fx-font-weight: 600;"/>
                <Circle radius="16" fill="#3B82F6"/>
            </HBox>
        </HBox>
    </top>

    <!-- ============================================
         CENTER - Main Dashboard Content
         ============================================ -->
    <center>
        <ScrollPane fitToWidth="true" fitToHeight="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED"
                    style="-fx-background: #F5F9FC; -fx-background-color: #F5F9FC;">
            <content>
                <VBox spacing="24" styleClass="center-container">
                    <padding>
                        <Insets top="32" right="32" bottom="32" left="32"/>
                    </padding>

                    <!-- ============================================
                         KPI CARDS SECTION - 4 Columns
                         ============================================ -->
                    <GridPane hgap="24" vgap="24">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="25" hgrow="ALWAYS"/>
                            <ColumnConstraints percentWidth="25" hgrow="ALWAYS"/>
                            <ColumnConstraints percentWidth="25" hgrow="ALWAYS"/>
                            <ColumnConstraints percentWidth="25" hgrow="ALWAYS"/>
                        </columnConstraints>
                        <rowConstraints>
                            <RowConstraints vgrow="NEVER"/>
                        </rowConstraints>

                        <!-- KPI Card 1: ROI -->
                        <VBox GridPane.rowIndex="0" GridPane.columnIndex="0" styleClass="card" spacing="8">
                            <Label text="ROI" styleClass="kpi-title"/>
                            <Label fx:id="roiValue" text="24.5%" styleClass="kpi-value"/>
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <Label text="↑ +3.2%" styleClass="badge badge-success"/>
                                <Label text="vs mes anterior" styleClass="muted"/>
                            </HBox>
                        </VBox>

                        <!-- KPI Card 2: Break-even Point -->
                        <VBox GridPane.rowIndex="0" GridPane.columnIndex="1" styleClass="card" spacing="8">
                            <Label text="PUNTO DE EQUILIBRIO" styleClass="kpi-title"/>
                            <Label fx:id="breakevenValue" text="$45,230" styleClass="kpi-value"/>
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <Label text="↓ -5.1%" styleClass="badge badge-danger"/>
                                <Label text="vs mes anterior" styleClass="muted"/>
                            </HBox>
                        </VBox>

                        <!-- KPI Card 3: Operating Profit -->
                        <VBox GridPane.rowIndex="0" GridPane.columnIndex="2" styleClass="card" spacing="8">
                            <Label text="UTILIDAD OPERATIVA" styleClass="kpi-title"/>
                            <Label fx:id="operatingProfitValue" text="$128,450" styleClass="kpi-value"/>
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <Label text="↑ +12.3%" styleClass="badge badge-success"/>
                                <Label text="vs mes anterior" styleClass="muted"/>
                            </HBox>
                        </VBox>

                        <!-- KPI Card 4: Profit Margin -->
                        <VBox GridPane.rowIndex="0" GridPane.columnIndex="3" styleClass="card" spacing="8">
                            <Label text="MARGEN DE UTILIDAD" styleClass="kpi-title"/>
                            <Label fx:id="profitMarginValue" text="18.7%" styleClass="kpi-value"/>
                            <HBox spacing="8" alignment="CENTER_LEFT">
                                <Label text="↑ +2.1%" styleClass="badge badge-success"/>
                                <Label text="vs mes anterior" styleClass="muted"/>
                            </HBox>
                        </VBox>
                    </GridPane>

                    <!-- ============================================
                         CHARTS SECTION - Sales Trend + Top Products
                         ============================================ -->
                    <HBox spacing="24">
                        <!-- Sales Trend Chart (2/3 width) -->
                        <VBox spacing="12" HBox.hgrow="ALWAYS" styleClass="surface" prefWidth="600">
                            <Label text="Tendencia de Ventas" style="-fx-font-weight: 700; -fx-font-size: 16px; -fx-text-fill: #0F172A;"/>
                            <LineChart fx:id="salesChart" legendVisible="true" animated="true"
                                       createSymbols="false" HBox.hgrow="ALWAYS" prefHeight="320">
                                <xAxis>
                                    <CategoryAxis label="Mes" side="BOTTOM"/>
                                </xAxis>
                                <yAxis>
                                    <NumberAxis label="Ventas (K)" side="LEFT" autoRanging="true"/>
                                </yAxis>
                            </LineChart>
                        </VBox>

                        <!-- Top Products List (1/3 width) -->
                        <VBox spacing="12" prefWidth="360" styleClass="surface">
                            <Label text="Top Productos" style="-fx-font-weight: 700; -fx-font-size: 16px; -fx-text-fill: #0F172A;"/>
                            <ListView fx:id="topProductsList" prefHeight="320" styleClass="list-view"/>
                        </VBox>
                    </HBox>

                    <!-- ============================================
                         ALERTS SECTION - Recent Alerts
                         ============================================ -->
                    <VBox spacing="12">
                        <Label text="Alertas Recientes" style="-fx-font-weight: 700; -fx-font-size: 18px; -fx-text-fill: #0F172A;"/>
                        <VBox styleClass="surface">
                            <ListView fx:id="recentAlertsList" prefHeight="240" styleClass="list-view"/>
                        </VBox>
                    </VBox>
                </VBox>
            </content>
        </ScrollPane>
    </center>
</BorderPane>
